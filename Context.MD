# Zaynarah â€“ Project Context & System Status

This document is the authoritative technical and product context for the **Zaynarah** e-commerce platform.  
It reflects the **current, real implementation state** of the system.

This file supersedes all prior assumptions and must remain in sync with **production behavior**.

---

## ğŸ“Œ Project Overview

**Zaynarah** is a luxury e-commerce platform focused on handcrafted Pashmina and heritage products.

The platform is architected as an **enterprise-grade, modular system** with:

- deterministic checkout flows
- server-authoritative order and payment state
- explicit session hydration guarantees
- production-safe routing and state isolation
- operational readiness for scale

The project is currently in a **backend-complete + frontend domain-stabilized phase**, with all **core commerce flows hardened, refactored, and verified**.

---

## ğŸ§± High-Level Architecture

### Frontend

- **Framework:** Vite + React
- **State Management:** Zustand
  - feature-scoped stores
  - strict separation of **domain state** vs **UI state**
  - hydration only where architecturally justified
- **UI System:** shadcn/ui
- **Routing:** React Router (hydration-aware, guarded)
- **Data Access:** Fetch / Axios (feature-scoped; consolidation pending)
- **UX Feedback:** Toast-based, non-blocking
- **Checkout Pattern:** Step-based deterministic state machine

### Backend

- **Runtime:** Node.js
- **Framework:** Express
- **Database:** MongoDB (Mongoose)
- **Authentication:** JWT + persistent sessions (JTI-based)
- **Queues:** Redis + BullMQ
- **Payments:** Stripe & Razorpay (server-authoritative)
- **Webhooks:** Stripe & Razorpay (signature verified)
- **Email:** SMTP (Nodemailer)
- **Invoice Generation:** HTML + PDF via Puppeteer

---

## ğŸ“Š Feature Status Matrix (Actual State)

| Feature / Module                 | Frontend Status | Backend Status | Notes                                                  |
| -------------------------------- | --------------- | -------------- | ------------------------------------------------------ |
| Auth (Login / Signup / Sessions) | âœ… Complete     | âœ… Complete    | Hydration-safe, remember-me, refresh-safe              |
| Users / Profile                  | âœ… Stable       | âœ… Complete    | Profile UI complete, orders removed                    |
| Products / Shop (PLP)            | âœ… Complete     | âœ… Complete    | Domain + UI stores finalized, page-scoped loading      |
| Product Detail Page (PDP)        | âœ… Complete     | âœ… Complete    | Store-driven, cached entities, cart-safe               |
| Cart (Guest + Auth)              | âœ… Complete     | âœ… Complete    | Guest persistence + merge-on-login                     |
| Mini Cart / Cart Badge           | âœ… Stable       | N/A            | Fully synced                                           |
| Checkout (State Machine)         | âœ… Complete     | âœ… Complete    | Domain + UI stores finalized                           |
| Orders                           | âœ… Complete     | âœ… Complete    | Domain + UI stores finalized                           |
| Payments                         | âœ… Stable       | âœ… Complete    | Webhook-authoritative                                  |
| Webhooks                         | âŒ UI           | âœ… Complete    | Production-safe                                        |
| Notifications (In-App)           | âœ… Complete     | âœ… Complete    | SSE + pagination + read state                          |
| Notifications (Email)            | âŒ UI           | âœ… Complete    | Rule-based                                             |
| Invoices (HTML + PDF)            | âš™ï¸ Partial UI   | âœ… Complete    | Download via Orders UI                                 |
| Refunds                          | âŒ UI           | âœ… Complete    | Admin-only                                             |
| Admin Dashboard                  | âš™ï¸ Partial UI   | âœ… Complete    | Frontend incomplete                                    |
| Categories / Filters             | âš™ï¸ Basic        | âš™ï¸ Partial     | Shop-level filtering stable, advanced faceting pending |
| Coupons / Discounts              | âŒ Not Started  | âŒ Not Started | â€”                                                      |
| Reviews                          | âš™ï¸ UI Only      | âŒ Not Started | APIs missing                                           |
| Wishlist                         | âš™ï¸ Local        | âŒ Not Started | Backend pending                                        |
| Uploads / Assets                 | âŒ Not Started  | âŒ Not Started | â€”                                                      |
| API Client Unification           | âš™ï¸ Partial      | âœ… Complete    | FE consolidation pending                               |
| Error Handling                   | âš™ï¸ Partial      | âœ… Complete    | FE boundaries pending                                  |
| Performance                      | âš™ï¸ Partial      | âš™ï¸ Partial     | FE optimizations pending                               |
| Testing / QA                     | âŒ Not Started  | âš™ï¸ Partial     | No FE tests                                            |
| Accessibility & SEO              | âŒ Not Started  | N/A            | â€”                                                      |
| CI/CD                            | âŒ Not Started  | âš™ï¸ Partial     | FE pipeline missing                                    |

---

## ğŸ›’ Cart & Checkout Philosophy

### Guest-First Commerce (Implemented)

- Full browsing and cart usage without authentication
- Persistent guest cart via `localStorage`
- Zero forced login friction

### Cart Merge on Login (Implemented)

- Safe merge on authentication
- Backend conflict resolution
- Guest cart cleared post-merge

---

## ğŸ§¾ Checkout Flow (Server-Authoritative)

1. Cart seeds checkout once
2. Checkout session initialized from cart snapshot
3. Shipping address selection
4. Shipping method selection
5. Pricing finalized (shipping + tax)
6. Order locked â†’ `priced`
7. Payment prepared â†’ `payment_pending`
8. **Payment confirmed ONLY via webhook**
9. Order marked paid, stock reduced, cart cleared

---

## ğŸ” Checkout State Guarantees (Hardened)

- Checkout domain store is the **single source of truth**
- Cart is never re-read after checkout initialization
- Shipping methods load only after address selection
- Totals persist across refresh via controlled hydration
- App-level hydration prevents redirect loops and blank screens
- No phantom items, no subtotal resets, no duplicate sessions

---

## ğŸ” Authentication & Sessions

- JWT with persistent session records
- Supports:
  - Remember-me
  - Multi-device sessions
  - Session revocation
  - Activity tracking
- Route guards wait for auth hydration
- Hard refresh on protected routes is safe
- Logout restores guest cart context

---

## ğŸ“¦ Orders (Frontend & Backend)

### Orders Frontend (Completed)

- Orders domain store finalized
- Orders UI store finalized
- Orders page fully wired
- Order details drawer wired correctly
- Invoice download routed through services layer
- Backend response shape handled defensively
- Orders UI removed from User Profile (single source of truth)
- No regressions

### Orders Backend (Stable)

- Server-authoritative order lifecycle
- Status normalization
- Invoice generation
- Payment-linked transitions
- Idempotent updates

---

## ğŸ“¦ Products (Frontend & Backend)

### Products Frontend (Completed)

- Products **domain store** finalized
- Products **UI store** finalized
- Normalized product entities with ID mapping
- Page-scoped fetching (Shop & Product pages only)
- Centralized caching with reuse across navigation
- Filters, sorting, pagination fully store-driven
- No App-level hydration
- No UI or behavior changes
- No regressions

### Products Backend (Stable)

- Paginated, filterable, sortable APIs
- Server-side validation
- Consistent response envelopes
- Defensive error handling

---

## ğŸ“© Notifications & Emails

### In-App Notifications (Complete)

- Stored in MongoDB
- Read/unread tracking
- Real-time delivery via SSE
- Pagination supported
- Deduplicated via queue job IDs

### Email Notifications

- Rule-based dispatch
- Async delivery via queue
- Invoice PDFs attached automatically
- SMTP provider configurable

---

## ğŸ’³ Payments & Webhooks

- No client-side payment confirmation
- Payments confirmed exclusively via:
  - Stripe webhooks
  - Razorpay webhooks
- Signature verification enforced
- Duplicate webhook safety implemented
- Stock decrement and cart clearing executed once

---

## ğŸ§ª Stability Assessment

### Fully Stable

- Authentication & session hydration
- Cart lifecycle
- Checkout domain & UI
- Orders frontend & backend
- Products frontend & backend
- Payments & webhooks
- Notifications (in-app & email)
- Invoice generation
- Protected routing & refresh behavior

### Needs Frontend Work

- Admin UI completeness
- API client consolidation
- Error boundary coverage

### Not Started

- Frontend testing
- Accessibility & SEO
- CI/CD (frontend)
- Uploads & asset pipeline

---

## ğŸ§­ Overall Project Health

- **Status:** ğŸŸ¢ Core commerce flows production-safe
- **Execution Progress:** ~97%
- **Architecture Quality:** â­â­â­â­â­ (commerce core)

### Primary Remaining Risks

- Frontend testing gap
- Admin UX completeness
- SEO & accessibility

---

## ğŸ“ Next Planned Phase

### ğŸ‘‰ Admin Frontend Completion / Frontend Testing (To Be Chosen)

- Complete Admin UI workflows
- Introduce frontend test coverage (unit + integration)
- Error boundary hardening
- Performance optimizations

---

**This document must be updated whenever system behavior, guarantees, or architecture changes.**
